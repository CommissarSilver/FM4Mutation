{
    "bug_id": 11,
    "bug_type": "SL SH SF",
    "buggy_lines": "",
    "code": "    private void _verifySharing()\n    {\n        if (_hashShared) {\n            _hashArea = Arrays.copyOf(_hashArea, _hashArea.length);\n            _names = Arrays.copyOf(_names, _names.length);\n            _hashShared = false;\n            // 09-Sep-2015, tatu: As per [jackson-core#216], also need to ensure\n            //    we rehash as needed, as need-rehash flag is not copied from parent\n        }\n        if (_needRehash) {\n            rehash();\n        }\n    }",
    "fixed_code": "    private void _verifySharing()\n    {\n        if (_hashShared) {\n            _hashArea = Arrays.copyOf(_hashArea, _hashArea.length);\n            _names = Arrays.copyOf(_names, _names.length);\n            _hashShared = false;\n            // 09-Sep-2015, tatu: As per [jackson-core#216], also need to ensure\n            //    we rehash as needed, as need-rehash flag is not copied from parent\n            _verifyNeedForRehash();\n        }\n        if (_needRehash) {\n            rehash();\n        }\n    }",
    "fixed_lines": "            _verifyNeedForRehash();",
    "masked_code": "    private void _verifySharing()\n    {\n        if (_hashShared) {\n            _hashArea = Arrays.copyOf(_hashArea, _hashArea.length);\n            _names = Arrays.copyOf(_names, _names.length);\n            _hashShared = false;\n            // 09-Sep-2015, tatu: As per [jackson-core#216], also need to ensure\n            //    we rehash as needed, as need-rehash flag is not copied from parent\n>>> [ INFILL ] <<<\n        }\n        if (_needRehash) {\n            rehash();\n        }\n    }",
    "project": "JacksonCore",
    "test_error_message": "java.lang.ArrayIndexOutOfBoundsException: 512",
    "test_framework": "defects4j",
    "test_line": "            assertToken(JsonToken.FIELD_NAME, parser.nextToken());",
    "test_name": "testSymbolTableExpansionBytes",
    "test_suite": "com.fasterxml.jackson.core.sym.SymbolsViaParserTest",
    "time_buggy": "2015-09-09 10:43:05 -0700",
    "time_fixed": "2015-09-09 10:59:56 -0700",
    "bug_description": "Bug ID: 11\nProject: JacksonCore\nBug Type: SL SH SF\n\nDescription:\nThe bug is located within the _verifySharing method of the JacksonCore project. The issue mainly resides in the lack of a necessary verification check before the rehashing procedure commences, leading the application to throw a java.lang.ArrayIndexOutOfBoundsException: 512.\n\nStep 1:\nWhen the _hashShared variable is true, the method will attempt to create a copy of _hashArea and _names arrays using their own length as the new arrays' lengths.\n\nStep 2:\nAfterwards, the _hashShared variable is set to false.\n\nStep 3:\nIn the situation where the _needRehash variable is also true, the method then calls another separate method, rehash(), which causes an ArrayIndexOutOfBoundsException because the application tries to access an array element that is out of bounds.\n\nStep 4:\nThis is likely because the _hashArea and/or _names array have been either under or over shot with the set length, resulting in an index out of bounds scenario when the rehash() method is called.\n\nFix:\nThe fixed code introduces an extra line of code just after the arrays' copy procedure and before the method proceeds with the _needRehash check. This new line of code calls the function _verifyNeedForRehash() which likely checks if there is an actual need for the method to call the rehash() method and reduces the chances of an ArrayIndexOutOfBoundsException being thrown again.\n\nWith the fixed code, before rehashing is done, the _verifyNeedForRehash method is called which seems to verify the need for rehash procedure. This likely reduces the occurrence of the ArrayIndexOutOfBoundsException. This demonstrates the necessity to always check the validity of array indexes before attempting to access elements within them in the Java programming language."
}