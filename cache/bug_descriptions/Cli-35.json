{
    "bug_id": 35,
    "bug_type": "SH SF",
    "buggy_lines": "",
    "code": "    public List<String> getMatchingOptions(String opt)\n    {\n        opt = Util.stripLeadingHyphens(opt);\n        \n        List<String> matchingOpts = new ArrayList<String>();\n\n        // for a perfect match return the single option only\n\n        for (String longOpt : longOpts.keySet())\n        {\n            if (longOpt.startsWith(opt))\n            {\n                matchingOpts.add(longOpt);\n            }\n        }\n        \n        return matchingOpts;\n    }",
    "fixed_code": "    public List<String> getMatchingOptions(String opt)\n    {\n        opt = Util.stripLeadingHyphens(opt);\n        \n        List<String> matchingOpts = new ArrayList<String>();\n\n        // for a perfect match return the single option only\n        if(longOpts.keySet().contains(opt)) {\n            return Collections.singletonList(opt);\n        }\n\n        for (String longOpt : longOpts.keySet())\n        {\n            if (longOpt.startsWith(opt))\n            {\n                matchingOpts.add(longOpt);\n            }\n        }\n        \n        return matchingOpts;\n    }",
    "fixed_lines": "        if(longOpts.keySet().contains(opt)) {\n            return Collections.singletonList(opt);\n        }",
    "masked_code": "    public List<String> getMatchingOptions(String opt)\n    {\n        opt = Util.stripLeadingHyphens(opt);\n        \n        List<String> matchingOpts = new ArrayList<String>();\n\n        // for a perfect match return the single option only\n>>> [ INFILL ] <<<\n\n        for (String longOpt : longOpts.keySet())\n        {\n            if (longOpt.startsWith(opt))\n            {\n                matchingOpts.add(longOpt);\n            }\n        }\n        \n        return matchingOpts;\n    }",
    "project": "Cli",
    "test_error_message": "org.apache.commons.cli.AmbiguousOptionException: Ambiguous option: '--prefix' (could be: 'prefix', 'prefixplusplus')",
    "test_framework": "defects4j",
    "test_line": "        new DefaultParser().parse(getOptions(), new String[]{\"--prefix\"});",
    "test_name": "testExactOptionNameMatch",
    "test_suite": "org.apache.commons.cli.bug.BugCLI252Test",
    "time_buggy": "2015-05-11 11:42:46 +0000",
    "time_fixed": "2015-06-09 05:18:22 +0000",
    "bug_description": "Bug ID: 35\n\nTitle: AmbiguousOptionException for '--prefix' command within the CLI project\n\nBug Description:\n\nIn the current implementation of the method getMatchingOptions(String opt) within the Cli project, it is observed that the application is unable to handle '--prefix' option correctly. This is causing an AmbiguousOptionException as the application is confused between 'prefix' and 'prefixplusplus' command options. \n\nSteps to reproduce:\n\n1. Invoke getMatchingOptions(string opt) method with '--prefix' as input.\n\nExpected Result: The application logic should identify the perfect matched available option and return the same.\n\nActual Result: An AmbiguousOptionException is thrown with the message: \"Ambiguous option: '--prefix' (could be: 'prefix', 'prefixplusplus')\n\nCorrective Action:\n\nThe bug in the 'getMatchingOptions' method in the 'Cli' project was identified to be in this section:\n\n```java\nfor (String longOpt : longOpts.keySet())\n{\n   if (longOpt.startsWith(opt))\n   {\n       matchingOpts.add(longOpt);\n   }\n}\n```\n\nIn the original code, it checks for all strings that start with the input option, thus causing the ambiguity between 'prefix' and 'prefixplusplus'.\n\nThe problem was resolved by adding a condition to check if there is an exact match of the option in 'longOpts'. If an exact match exists, the option is directly returned. The corrected code is as follows:\n\n```java\nif(longOpts.keySet().contains(opt)) {\n    return Collections.singletonList(opt);\n}\n\nfor (String longOpt : longOpts.keySet())\n{\n   if (longOpt.startsWith(opt))\n   {\n       matchingOpts.add(longOpt);\n   }\n}\n```\n\nIn the corrected code, if the exact match is found in the keySet of 'longOpts', the list containing only that matching option is returned, otherwise, it will continue with the old logic.\n\nThis solution corrects the exception for ambiguous command."
}